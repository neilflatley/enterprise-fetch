var efetch=function(t,e){"use strict";function r(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var o=r(e);function n(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function i(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,o)}return r}function s(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?i(Object(r),!0).forEach((function(e){n(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function u(t,e){if(null==t)return{};var r,o,n=function(t,e){if(null==t)return{};var r,o,n={},i=Object.keys(t);for(o=0;o<i.length;o++)r=i[o],e.indexOf(r)>=0||(n[r]=t[r]);return n}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(o=0;o<i.length;o++)r=i[o],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}function a(t,e){for(const r in e)Object.defineProperty(t,r,{value:e[r],enumerable:!0,configurable:!0});return t}var c=function(t,e,r){if(!t||"string"==typeof t)throw new TypeError("Please pass an Error to err-code");r||(r={}),"object"==typeof e&&(r=e,e=void 0),null!=e&&(r.code=e);try{return a(t,r)}catch(e){r.message=t.message,r.stack=t.stack;const o=function(){};return o.prototype=Object.create(Object.getPrototypeOf(t)),a(new o,r)}};function p(t,e){"boolean"==typeof e&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(t)),this._timeouts=t,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}var f=p;p.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts},p.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timeouts=[],this._cachedTimeouts=null},p.prototype.retry=function(t){if(this._timeout&&clearTimeout(this._timeout),!t)return!1;var e=(new Date).getTime();if(t&&e-this._operationStart>=this._maxRetryTime)return this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(t);var r=this._timeouts.shift();if(void 0===r){if(!this._cachedTimeouts)return!1;this._errors.splice(this._errors.length-1,this._errors.length),this._timeouts=this._cachedTimeouts.slice(0),r=this._timeouts.shift()}var o=this,n=setTimeout((function(){o._attempts++,o._operationTimeoutCb&&(o._timeout=setTimeout((function(){o._operationTimeoutCb(o._attempts)}),o._operationTimeout),o._options.unref&&o._timeout.unref()),o._fn(o._attempts)}),r);return this._options.unref&&n.unref(),!0},p.prototype.attempt=function(t,e){this._fn=t,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout((function(){r._operationTimeoutCb()}),r._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},p.prototype.try=function(t){console.log("Using RetryOperation.try() is deprecated"),this.attempt(t)},p.prototype.start=function(t){console.log("Using RetryOperation.start() is deprecated"),this.attempt(t)},p.prototype.start=p.prototype.try,p.prototype.errors=function(){return this._errors},p.prototype.attempts=function(){return this._attempts},p.prototype.mainError=function(){if(0===this._errors.length)return null;for(var t={},e=null,r=0,o=0;o<this._errors.length;o++){var n=this._errors[o],i=n.message,s=(t[i]||0)+1;t[i]=s,s>=r&&(e=n,r=s)}return e};var m,h=(function(t,e){e.operation=function(t){var r=e.timeouts(t);return new f(r,{forever:t&&t.forever,unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})},e.timeouts=function(t){if(t instanceof Array)return[].concat(t);var e={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var r in t)e[r]=t[r];if(e.minTimeout>e.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var o=[],n=0;n<e.retries;n++)o.push(this.createTimeout(n,e));return t&&t.forever&&!o.length&&o.push(this.createTimeout(n,e)),o.sort((function(t,e){return t-e})),o},e.createTimeout=function(t,e){var r=e.randomize?Math.random()+1:1,o=Math.round(r*e.minTimeout*Math.pow(e.factor,t));return o=Math.min(o,e.maxTimeout)},e.wrap=function(t,r,o){if(r instanceof Array&&(o=r,r=null),!o)for(var n in o=[],t)"function"==typeof t[n]&&o.push(n);for(var i=0;i<o.length;i++){var s=o[i],u=t[s];t[s]=function(o){var n=e.operation(r),i=Array.prototype.slice.call(arguments,1),s=i.pop();i.push((function(t){n.retry(t)||(t&&(arguments[0]=n.mainError()),s.apply(this,arguments))})),n.attempt((function(){o.apply(t,i)}))}.bind(t,u),t[s].options=r}}}(m={exports:{}},m.exports),m.exports),l=Object.prototype.hasOwnProperty;function y(t){return t&&"EPROMISERETRY"===t.code&&l.call(t,"retried")}var _=function(t,e){var r,o;return"object"==typeof t&&"function"==typeof e&&(r=e,e=t,t=r),o=h.operation(e),new Promise((function(e,r){o.attempt((function(n){Promise.resolve().then((function(){return t((function(t){throw y(t)&&(t=t.retried),c(new Error("Retrying"),"EPROMISERETRY",{retried:t})}),n)})).then(e,(function(t){y(t)&&(t=t.retried,o.retry(t||new Error))||r(t)}))}))}))};const{AbortController:d,AbortSignal:b}="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0;var v=d,T=b,g=d;v.AbortSignal=T,v.default=g;const w={timeout:6e4,retry:{retries:3,minTimeout:400,factor:2},doRetry:async(t,e,{url:r,options:o})=>{const{retry:n=w.retry}=o;if(t<=n.retries){const o=`${t}/${n.retries}`;if("message"in e?console.warn(`[fetch] Attempt ${o} ${e.name}: ${e.message} ${r}`):console.warn(`[fetch] Attempt ${o} ${e.status}: ${e.statusText} ${r}`),!e.status||e.status>=400&&404!==e.status)return!0}return!1}},O=t=>"function"==typeof t,j="undefined"!=typeof window?window.fetch:o.default,P=(t=w)=>async(e,r={})=>await _((async(o,n)=>{const{retry:i=t.retry,timeout:a=t.timeout,doRetry:c=t.doRetry||w.doRetry}=r,p=u(r,["retry","timeout","doRetry"]),f=a||t.timeout||6e4,m=new v;setTimeout((()=>{m.abort()}),f);const[h,l]=await(y=j(e,s(s(s({},p),await(async()=>{const t="undefined"!=typeof process&&process.env.http_proxy||!1;if(t){console.info(`Proxying via http_proxy: ${process.env.http_proxy}`),process.env.NODE_TLS_REJECT_UNAUTHORIZED="0";const{HttpsProxyAgent:e}=await"https-proxy-agent";return{agent:new e(t)}}return{}})()),{},{signal:m.signal})),y.then((function(t){return[null,t]})).catch((function(t){return _&&Object.assign(t,_),[t,void 0]})));var y,_;if(h)throw O(c)&&await c(n,h,{url:e,options:r})&&o(h),h;return l.ok||O(c)&&await c(n,l,{url:e,options:r})&&o(l),l}),r.retry||t.retry);var R=P(w);return t.default=R,t.fetchWithDefaults=P,Object.defineProperty(t,"__esModule",{value:!0}),t}({},fetch);
